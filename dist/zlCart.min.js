/*! zl-cart v1.0.9 */
 "use strict";angular.module("zlCart",["zlCart.directives"]).config([function(){}]).provider("$zlCart",function(){this.$get=function(){}}).run(["$rootScope","zlCart","zlCartItem","zlStore",function(a,b,c,d){a.$on("zlCart:change",function(){b.$save()}),angular.isObject(d.get("zlcart"))?b.$restore(d.get("zlcart")):b.init()}]).service("zlCart",["$rootScope","zlCartItem","zlStore",function(a,b,c){this.init=function(){this.$cart={shipping:null,items:[]}},this.addItem=function(c,d,e,f,g,h,i){var j=this.getItemById(c);if("object"==typeof j)j.setQuantity(g,!0);else{var k=new b(c,d,e,f,g,h,i);this.$cart.items.push(k),a.$broadcast("zlCart:itemAdded",k)}a.$broadcast("zlCart:change",{})},this.getItemById=function(a){var b=this.getCart().items,c=!1;return angular.forEach(b,function(b){b.getId()===a&&(c=b)}),c},this.setShipping=function(a){return this.$cart.shipping=a,this.getShipping()},this.getShipping=function(){return 0==this.getCart().items.length?0:this.getCart().shipping},this.setCart=function(a){return this.$cart=a,this.getCart()},this.getCart=function(){return this.$cart},this.getItems=function(){return this.getCart().items},this.getTotalItems=function(){var a=0,b=this.getItems();return angular.forEach(b,function(b){a+=b.getQuantity()}),a},this.getTotalUniqueItems=function(){return this.getCart().items.length},this.getSubTotal=function(){var a=0;return angular.forEach(this.getCart().items,function(b){a+=b.getTotal()}),+parseFloat(a).toFixed(2)},this.getSubTotalWithoutTax=function(){var a=0;return angular.forEach(this.getCart().items,function(b){a+=b.getTotalWithoutTax()}),+parseFloat(a).toFixed(2)},this.getSubTotalWithDiscount=function(){var a=0;return angular.forEach(this.getCart().items,function(b){a+=b.getTotalWithDiscount()}),+parseFloat(a).toFixed(2)},this.getTotalDiscount=function(){var a=0;return angular.forEach(this.getCart().items,function(b){a+=b.getTotal()-b.getTotalWithDiscount()}),+parseFloat(a).toFixed(2)},this.totalCost=function(){return+parseFloat(this.getSubTotal()-this.getTotalDiscount()+this.getShipping())},this.removeItem=function(b){this.$cart.items.splice(b,1),a.$broadcast("zlCart:itemRemoved",{}),a.$broadcast("zlCart:change",{})},this.removeItemById=function(b){var c=this.getCart();angular.forEach(c.items,function(a,d){a.getId()===b&&c.items.splice(d,1)}),this.setCart(c),a.$broadcast("zlCart:itemRemoved",{}),a.$broadcast("zlCart:change",{})},this.empty=function(){a.$broadcast("zlCart:change",{}),this.$cart.items=[],localStorage.removeItem("zlcart")},this.isEmpty=function(){return!(this.$cart.items.length>0)},this.toObject=function(){if(0===this.getItems().length)return!1;var a=[];return angular.forEach(this.getItems(),function(b){a.push(b.toObject())}),{shipping:this.getShipping(),subTotal:this.getSubTotal(),totalCost:this.totalCost(),items:a}},this.$restore=function(a){var c=this;c.init(),c.$cart.shipping=a.shipping,angular.forEach(a.items,function(a){c.$cart.items.push(new b(a._id,a._name,a._price,a._tax,a._quantity,a._discount,a._data))}),this.$save()},this.$save=function(){return c.set("zlcart",JSON.stringify(this.getCart()))}}]).factory("zlCartItem",["$rootScope","$log",function(a,b){var c=function(a,b,c,d,e,f,g){this.setId(a),this.setName(b),this.setTax(d),this.setPrice(c),this.setDiscount(f),this.setQuantity(e),this.setData(g)};return c.prototype.setId=function(a){a?this._id=a:b.error("An ID must be provided")},c.prototype.getId=function(){return this._id},c.prototype.setName=function(a){a?this._name=a:b.error("A name must be provided")},c.prototype.getName=function(){return this._name},c.prototype.setTax=function(a){this._tax=+a},c.prototype.getTax=function(a){return this._tax},c.prototype.setPrice=function(a){var c=parseFloat(a||0);c>=0?this._price=c:b.error("A price must be over 0")},c.prototype.getPrice=function(){return this._price},c.prototype.getPriceWithoutTax=function(){return this._price-this._price/100*this._tax},c.prototype.getPriceWithDiscount=function(){var a=this.getPrice();return a-a*(this.getDiscount()/100)},c.prototype.setDiscount=function(b){var c=parseInt(b||0);c>=0?this._discount=c:this._discount=0,a.$broadcast("zlCart:change",{})},c.prototype.getDiscount=function(){return this._discount},c.prototype.setQuantity=function(c,d){var e=parseInt(c);e%1===0?(d===!0?this._quantity+=e:this._quantity=e,this._quantity<1&&(this._quantity=1)):(this._quantity=1,b.info("Quantity must be an integer and was defaulted to 1")),a.$broadcast("zlCart:change",{})},c.prototype.getQuantity=function(){return this._quantity},c.prototype.setData=function(a){a&&(this._data=a)},c.prototype.getData=function(){return this._data?this._data:void b.info("This item has no data")},c.prototype.getTotal=function(){return+parseFloat(this.getQuantity()*this.getPrice()).toFixed(2)},c.prototype.getTotalWithoutTax=function(){return+parseFloat(this.getQuantity()*this.getPriceWithoutTax()).toFixed(2)},c.prototype.getTotalWithDiscount=function(){return+parseFloat(this.getQuantity()*this.getPriceWithDiscount()).toFixed(2)},c.prototype.toObject=function(){return{id:this.getId(),name:this.getName(),price:this.getPrice(),priceWithoutTax:this.getPriceWithoutTax(),priceWithDiscount:this.getPriceWithDiscount(),tax:this.getTax(),discount:this.getDiscount(),quantity:this.getQuantity(),data:this.getData(),total:this.getTotal(),totalWithoutTax:this.getTotalWithoutTax(),totalWithDiscount:this.getTotalWithDiscount()}},c}]).service("zlStore",["$window",function(a){return{get:function(b){if(a.localStorage[b]){var c=angular.fromJson(a.localStorage[b]);return JSON.parse(c)}return!1},set:function(b,c){return void 0===c?a.localStorage.removeItem(b):a.localStorage[b]=angular.toJson(c),a.localStorage[b]}}}]).service("zlCartDiscount",["$rootScope","zlCart","$http","$q",function(a,b,c,d){this.init=function(){this.urlDiscount="/api/getdiscount/"},this.setUrlDiscount=function(a){this.urlDiscount=a},this.getUrlDiscount=function(){return this.urlDiscount},this.setDiscount=function(a,d){var e=b.getCart();c.post(this.getUrlDiscount()+a,{cart:e}).then(function(a){a.data&&b.$restore(angular.fromJson(a.data)),d()},function(a){d(a)})}}]).controller("CartController",["$scope","zlCart",function(a,b){a.zlCart=b}]).value("version","1.0.9"),angular.module("zlCart.directives",["zlCart.fulfilment"]).controller("zlCartController",["$scope","zlCart",function(a,b){a.zlCart=b}]).directive("zlcartAddtocart",["zlCart",function(a){return{restrict:"E",controller:"zlCartController",scope:{id:"@",name:"@",quantity:"@",quantityMax:"@",price:"@",tax:"@",data:"="},transclude:!0,replace:!0,templateUrl:function(a,b){return"undefined"==typeof b.templateUrl?"template/addtocart.html":b.templateUrl},link:function(b,c,d){b.attrs=d,b.inCart=function(){return a.getItemById(d.id)},b.inCart()?b.q=a.getItemById(d.id).getQuantity():b.q=parseInt(b.quantity),b.qtyOpt=[];for(var e=1;e<=b.quantityMax;e++)b.qtyOpt.push(e)}}}]).directive("zlcartCart",[function(){return{restrict:"E",controller:"zlCartController",scope:{},replace:!0,templateUrl:function(a,b){return"undefined"==typeof b.templateUrl?"template/cart.html":b.templateUrl},link:function(a,b,c){}}}]).directive("zlcartSummary",[function(){return{restrict:"E",controller:"zlCartController",scope:{},transclude:!0,replace:!0,templateUrl:function(a,b){return"undefined"==typeof b.templateUrl?"template/summary.html":b.templateUrl}}}]).directive("zlcartTax",["zlCart",function(a){return{restrict:"E",controller:"zlCartController",scope:{},transclude:!0,replace:!0,templateUrl:function(a,b){return"undefined"==typeof b.templateUrl?"template/carttax.html":b.templateUrl},link:function(b,c,d){var e=[],f=[],g=0;angular.forEach(a.getCart().items,function(a){var b=a.getTax(),c=a.getTotal(),d=+parseFloat(c/100*b).toFixed(2);if(e[b])for(var g=0;g<f.length;g++)f[g].rate===b&&(f[g].tax+=d,f[g].value+=c);else e[b]=!0,f.push({rate:b,tax:d,value:c})}),f.forEach(function(a){g+=a.value}),b.taxsRate=f,b.taxTotal=g}}}]).directive("zlcartDiscount",["zlCartDiscount",function(a){return{restrict:"E",controller:"zlCartController",scope:{},transclude:!0,replace:!0,templateUrl:function(a,b){return"undefined"==typeof b.templateUrl?"template/discount.html":b.templateUrl},link:function(b,c,d){b.attrs=d,b.message={},b.$watch("code",function(a,c){a!==c&&(b.message={})}),b.setCodeDiscount=function(c){a.setDiscount(c,function(a){return b.message.msg=!0,a?(b.message.success=!1,void(b.message.text=a.data)):(b.message.success=!0,b.message.text="CÃ³digo consumido com sucesso.",void(b.code=""))})}}}}]).directive("zlcartCheckout",[function(){return{restrict:"E",scope:{service:"@",settings:"="},transclude:!0,replace:!0,templateUrl:function(a,b){return"undefined"==typeof b.templateUrl?"template/checkout.html":b.templateUrl},controller:["$rootScope","$scope","$window","zlCart","fulfilmentProvider",function(a,b,c,d,e){b.zlCart=d,b.checkout=function(){e.setService(b.service),e.setSettings(b.settings),e.checkout().success(function(d,e,f,g){"meowallet"===b.service&&(c.location.href=d.url_redirect),a.$broadcast("zlCart:checkout_succeeded",d)}).error(function(b,c,d,e){a.$broadcast("zlCart:checkout_failed",{statusCode:c,error:b})})}}]}}]),angular.module("zlCart.fulfilment",[]).service("fulfilmentProvider",["$injector",function(a){this._obj={service:void 0,settings:void 0},this.setService=function(a){this._obj.service=a},this.setSettings=function(a){this._obj.settings=a},this.checkout=function(){var b=a.get("zlCart.fulfilment."+this._obj.service);return b.checkout(this._obj.settings)}}]).service("zlCart.fulfilment.log",["$q","$log","zlCart",function(a,b,c){this.checkout=function(){var d=a.defer();return b.info(c.toObject()),d.resolve({cart:c.toObject()}),d.promise}}]).service("zlCart.fulfilment.http",["$http","zlCart",function(a,b){this.checkout=function(c){return a.post(c.url,{data:b.toObject(),options:c.options})}}]).service("zlCart.fulfilment.meowallet",["$http","zlCart",function(a,b){this.checkout=function(c){return a.post(c.url,{data:b.toObject()})}}]).service("zlCart.fulfilment.paypal",["$http","zlCart",function(a,b){}]);