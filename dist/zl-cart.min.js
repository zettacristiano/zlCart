/*! zl-cart v1.0.28 */


"use strict";angular.module("zlCart",["zlCart.directives","LocalStorageModule"]).config(["localStorageServiceProvider",function(a){a.setPrefix("zlCart").setStorageType("sessionStorage")}]).provider("$zlCart",function(){this.$get=function(){}}).run(["$rootScope","zlCart","zlCartItem","zlStore",function(a,b,c,d){a.$on("zlCart:change",function(){b.$save()}),angular.isObject(d.get("zlcart"))?b.$restore(d.get("zlcart")):b.init()}]).service("zlCart",["$rootScope","zlCartItem","zlCartUtil","zlStore",function(a,b,c,d){this.init=function(){this.$cart={taxIncluded:null,shipping:null,promo:null,items:[]}},this.addItem=function(d,e,f,g,h,i,j){var k=this.getItemById(d);if("object"==typeof k)k.setQuantity(h);else{f=+c.round(this.getTaxIncluded()?+f/(+g/100+1):+f,2);var l=new b(d,e,f,g,h,i,this.getPromo(),j);this.$cart.items.push(l),a.$broadcast("zlCart:itemAdded",l)}a.$broadcast("zlCart:change",{})},this.getItemById=function(a){var b=this.getCart().items,c=!1;return angular.forEach(b,function(b){b.getId()===a&&(c=b)}),c},this.getItemByRegex=function(a){var b=this.getCart().items,c=!1,d=new RegExp(a,"ig");return angular.forEach(b,function(a){d.test(a.getId())&&(c=a)}),c},this.setPromo=function(b){this.$cart.promo=b;var c=this.getItems();angular.forEach(c,function(a){if(b){b.products.some(function(b,c,d){return b.productId.toString()===a.getId()&&b.check})?a.setPromo(b):a.setPromo(null)}else a.setPromo(b)}),a.$broadcast("zlCart:change",{})},this.getPromo=function(){return this.getCart().promo||null},this.setShipping=function(a){return this.$cart.shipping=a,this.getShipping()},this.getShipping=function(){return 0==this.getCart().items.length?0:this.getCart().shipping},this.setTaxIncluded=function(a){return this.$cart.taxIncluded=a,this.getTaxIncluded()},this.getTaxIncluded=function(){return this.getCart().taxIncluded},this.setCart=function(a){return this.$cart=a,this.getCart()},this.getCart=function(){return this.$cart},this.getItems=function(){return this.getCart().items},this.getTotalItems=function(){var a=0,b=this.getItems();return angular.forEach(b,function(b){a+=b.getQuantity()}),a},this.getTotalUniqueItems=function(){return this.getCart().items.length},this.getSubTotal=function(){var a=0;return angular.forEach(this.getCart().items,function(b){a+=b.getTotal()}),+c.round(a,2)},this.getSubTotalWithTax=function(){var a=0;return angular.forEach(this.getCart().items,function(b){a+=b.getTotalWithTax()}),+c.round(a,2)},this.getTotalDiscount=function(){var a=this.getPromo(),b=this.getItems();if(!a||0===b.length)return 0;var d=0;return angular.forEach(b,function(a){d+=+a.getTotalDiscount()}),+c.round(d,2)},this.totalCost=function(){return+c.round(this.getSubTotalWithTax()+this.getShipping(),2)},this.removeItem=function(b){this.$cart.items.splice(b,1),a.$broadcast("zlCart:itemRemoved",{}),a.$broadcast("zlCart:change",{})},this.removeItemById=function(b){var c=this.getCart();angular.forEach(c.items,function(a,d){a.getId()===b&&c.items.splice(d,1)}),this.setCart(c),a.$broadcast("zlCart:itemRemoved",{}),a.$broadcast("zlCart:change",{})},this.empty=function(){this.$cart.items=[],this.promo=null,a.$broadcast("zlCart:change",{})},this.isEmpty=function(){return!(this.$cart.items.length>0)},this.toObject=function(){if(0===this.getItems().length)return!1;var a=[];return angular.forEach(this.getItems(),function(b){a.push(b.toObject())}),{shipping:this.getShipping(),promo:this.getPromo(),subTotal:this.getSubTotal(),subTotalWithTax:this.getSubTotalWithTax(),totalDiscount:this.getTotalDiscount(),totalCost:this.totalCost(),items:a}},this.$restore=function(a){var c=this;c.init(),c.$cart.shipping=a.shipping,c.$cart.promo=a.promo,c.$cart.taxIncluded=a.taxIncluded,angular.forEach(a.items,function(a){c.$cart.items.push(new b(a._id,a._name,a._price,a._tax,a._quantity,a._discount,a._promo,a._data))}),this.$save()},this.$save=function(){return d.set("zlcart",JSON.stringify(this.getCart()))}}]).factory("zlCartItem",["$rootScope","zlCartUtil","$log",function(a,b,c){var d=function(a,b,c,d,e,f,g,h){this.setId(a),this.setName(b),this.setTax(d),this.setPrice(c),this.setDiscount(f),this.setQuantity(e),this.setPromo(g),this.setData(h)};return d.prototype.setId=function(a){a?this._id=a:c.error("An ID must be provided")},d.prototype.getId=function(){return this._id},d.prototype.setName=function(a){a?this._name=a:c.error("A name must be provided")},d.prototype.getName=function(){return this._name},d.prototype.setTax=function(a){this._tax=+a},d.prototype.getTax=function(a){return this._tax},d.prototype.setPrice=function(a){var d=b.round(a||0,2);d>=0?this._price=d:c.error("A price must be over 0")},d.prototype.getPrice=function(){return+b.round(this._price-this._price*this.getDiscount()/100,2)},d.prototype.setDiscount=function(a){this._discount=a||0},d.prototype.getDiscount=function(){return this._discount},d.prototype.setPromo=function(a){this._promo=a},d.prototype.getPromo=function(){return this._promo||null},d.prototype.setQuantity=function(b,d){var e=parseInt(b);e%1==0?(!0===d?this._quantity+=e:this._quantity=e,this._quantity<1&&(this._quantity=1)):(this._quantity=1,c.info("Quantity must be an integer and was defaulted to 1")),a.$broadcast("zlCart:change",{})},d.prototype.getQuantity=function(){return this._quantity},d.prototype.setData=function(a){a&&(this._data=a)},d.prototype.getData=function(){if(this._data)return this._data;c.info("This item has no data")},d.prototype.getTotalDiscount=function(){var a=this.getPromo(),c=this.getQuantity(),d=this.getPrice(),e=0;if(!a||0===c)return b.round(e,2);var f=a.value,e=f;"%"===a.symbol&&(f=+b.round(d*f/100,2));var g=c,h=a.parcial||1;return g=c-c%h,e="%"===a.symbol?f*g:f*(g/h),+b.round(e,2)},d.prototype.getTotal=function(){return+b.round(+this.getPrice()*+this.getQuantity()-+this.getTotalDiscount(),2)},d.prototype.getTotalWithTax=function(){return+b.round(this.getTotal()+this.getTotal()*this.getTax()/100,2)},d.prototype.toObject=function(){return{id:this.getId(),name:this.getName(),price:this.getPrice(),tax:this.getTax(),promo:this.getPromo(),quantity:this.getQuantity(),data:this.getData(),total:this.getTotal(),totalDiscount:this.getTotalDiscount(),totalWithTax:this.getTotalWithTax()}},d}]).service("zlStore",["localStorageService",function(a){this.get=function(b){if(a.get(b)){var c=angular.fromJson(a.get(b));return"object"==typeof c?c:JSON.parse(c)}return!1},this.set=function(b,c){return void 0===c?a.remove(b):a.set(b,c),a.get(b)}}]).service("zlCartDiscount",["$rootScope","zlCart","$http","$q",function(a,b,c,d){this.init=function(){this.urlDiscount=null},this.canApplyDiscount=function(){return void 0!==this.urlDiscount},this.setUrlDiscount=function(a){this.urlDiscount=a},this.getUrlDiscount=function(){return this.urlDiscount},this.setDiscount=function(a,d){var e=b.getCart();c.post(this.getUrlDiscount()+a,{cart:e}).then(function(a){a.data&&b.setPromo(a.data),d()}).catch(function(a){b.setPromo(null),d(a.data.error)})}}]).service("zlCartUtil",function(){this.round=function(a,b){void 0===b&&(b=0);var c=Math.pow(10,b);return a=+parseFloat((a*c).toFixed(11)).toFixed(1),(Math.round(a)/c).toFixed(2)}}).value("version","1.0.28"),angular.module("zlCart.directives",["zlCart.fulfilment"]).controller("zlCartController",["$scope","zlCart",function(a,b){a.zlCart=b}]).directive("zlcartAddtocart",["zlCart","zlCartDiscount",function(a,b){return{restrict:"E",controller:"zlCartController",scope:{id:"@",name:"@",quantity:"@",quantityMax:"@",price:"@",tax:"@",data:"=",checkItem:"@?"},transclude:!0,replace:!0,templateUrl:function(a,b){return void 0===b.templateUrl?"template/addtocart.html":b.templateUrl},link:function(b,c,d){b.attrs=d,b.inCart=function(){return d.checkItem?a.getItemByRegex(d.checkItem):a.getItemById(d.id)},b.inCart()?b.q=a.getItemById(d.id).getQuantity():b.q=parseInt(b.quantity),b.qtyOpt=[];for(var e=1;e<=b.quantityMax;e++)b.qtyOpt.push(e)}}}]).directive("zlcartCart",[function(){return{restrict:"E",controller:"zlCartController",scope:{},replace:!0,templateUrl:function(a,b){return void 0===b.templateUrl?"template/cart.html":b.templateUrl},link:function(a,b,c){}}}]).directive("zlcartSummary",[function(){return{restrict:"E",controller:"zlCartController",scope:{},transclude:!0,replace:!0,templateUrl:function(a,b){return void 0===b.templateUrl?"template/summary.html":b.templateUrl}}}]).directive("zlcartTax",["zlCart",function(a){return{restrict:"E",controller:"zlCartController",scope:{},transclude:!0,replace:!0,templateUrl:function(a,b){return void 0===b.templateUrl?"template/carttax.html":b.templateUrl},link:function(b,c,d){function e(){var c=[],d=[],e=0,g=0;angular.forEach(a.getItems(),function(a){var b=a.getTax(),f=a.getTotalWithTax()-a.getTotal(),h=a.getTotal(),i=+(f+h);if(c[b])for(var j=0;j<d.length;j++)d[j].rate===b&&(d[j].tax+=f,d[j].value+=h,d[j].subTotal+=i);else c[b]=!0,d.push({rate:b,tax:f,value:h,subTotal:i});e+=i,g+=f}),b.taxsRate=d,b.taxTotalIva=g,b.taxTotal=e,f=!1}var f=!1;e(),b.$on("zlCart:change",function(a,b){f||(f=!0,e())})}}}]).directive("zlcartDiscount",["zlCart","zlCartDiscount",function(a,b){return{restrict:"E",controller:"zlCartController",scope:{},transclude:!0,replace:!1,templateUrl:function(a,b){return void 0===b.templateUrl?"template/discount.html":b.templateUrl},link:function(c,d,e){c.attrs=e,c.message={},a.getPromo()&&(c.code=a.getPromo().code),c.$watch("code",function(a,b){a!==b&&(c.message={})}),c.removeCodeDiscount=function(b){a.setPromo(null)},c.setCodeDiscount=function(d){b.setDiscount(d,function(b){if(c.message.msg=!0,b)return c.message.success=!1,void(c.message.text=b);c.message.success=!0,c.message.text="CÃ³digo aplicado com sucesso.",c.code=(a.getPromo()||{}).code,setTimeout(function(){c.message.msg=!1,c.$apply()},2500)})},c.$on("zlCart:itemAdded",function(b){a.setPromo(a.getPromo())})}}}]).directive("zlcartCheckout",[function(){return{restrict:"E",scope:{service:"@",settings:"="},transclude:!0,replace:!1,templateUrl:function(a,b){return void 0===b.templateUrl?"template/checkout.html":b.templateUrl},controller:["$rootScope","$scope","$location","$route","zlCart","fulfilmentProvider",function(a,b,c,d,e,f){b.zlCart=e,b.checkout=function(){f.setService(b.service),f.setSettings(b.settings),f.checkout().then(function(b){b.data.url_redirect&&c.path(b.data.url_redirect),e.empty(),a.$broadcast("zlCart:checkout_succeeded",data)}).catch(function(b){a.$broadcast("zlCart:checkout_failed",{statusCode:b.status,error:b.data})})}}]}}]),angular.module("zlCart.fulfilment",[]).service("fulfilmentProvider",["$injector",function(a){this._obj={service:void 0,settings:void 0},this.setService=function(a){this._obj.service=a},this.setSettings=function(a){this._obj.settings=a},this.checkout=function(){return a.get("zlCart.fulfilment."+this._obj.service).checkout(this._obj.settings)}}]).service("zlCart.fulfilment.log",["$q","$log","zlCart",function(a,b,c){this.checkout=function(){var d=a.defer();return b.info(c.toObject()),d.resolve({cart:c.toObject()}),d.promise}}]).service("zlCart.fulfilment.http",["$http","zlCart",function(a,b){this.checkout=function(c){return a.post(c.url,{data:b.toObject(),options:c.options})}}]).service("zlCart.fulfilment.meowallet",["$http","zlCart",function(a,b){this.checkout=function(c){return a.post(c.url,{data:b.toObject()})}}]).service("zlCart.fulfilment.paypal",["$http","zlCart",function(a,b){}]);