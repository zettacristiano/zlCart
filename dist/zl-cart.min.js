/*! zl-cart v1.0.30 */


"use strict";angular.module("zlCart",["zlCart.directives","LocalStorageModule"]).config(["localStorageServiceProvider",function(t){t.setPrefix("zlCart").setStorageType("sessionStorage")}]).provider("$zlCart",function(){this.$get=function(){}}).run(["$rootScope","zlCart","zlCartItem","zlStore",function(t,e,r,i){t.$on("zlCart:change",function(){e.$save()}),angular.isObject(i.get("zlcart"))?e.$restore(i.get("zlcart")):e.init()}]).service("zlCart",["$rootScope","zlCartItem","zlCartUtil","zlStore",function(u,l,h,t){this.init=function(){this.$cart={taxIncluded:null,shipping:null,promo:null,items:[]}},this.addItem=function(t,e,r,i,o,n,a){var s=this.getItemById(t);if("object"==typeof s)s.setQuantity(o);else{r=+h.round(this.getTaxIncluded()?+r/(+i/100+1):+r,2);var c=new l(t,e,r,i,o,n,this.getPromo(),a);this.$cart.items.push(c),u.$broadcast("zlCart:itemAdded",c)}u.$broadcast("zlCart:change",{})},this.getItemById=function(e){var t=this.getCart().items,r=!1;return angular.forEach(t,function(t){t.getId()===e&&(r=t)}),r},this.getItemByRegex=function(t){var e=this.getCart().items,r=!1,i=new RegExp(t,"ig");return angular.forEach(e,function(t){i.test(t.getId())&&(r=t)}),r},this.setPromo=function(t){this.$cart.promo=t;var e=this.getItems();angular.forEach(e,function(i){t?t.products.some(function(t,e,r){return t.productId.toString()===i.getId()&&t.check})?i.setPromo(t):i.setPromo(null):i.setPromo(t)}),u.$broadcast("zlCart:change",{})},this.getPromo=function(){return this.getCart().promo||null},this.setShipping=function(t){return this.$cart.shipping=t,this.getShipping()},this.getShipping=function(){return 0==this.getCart().items.length?0:this.getCart().shipping},this.setTaxIncluded=function(t){return this.$cart.taxIncluded=t,this.getTaxIncluded()},this.getTaxIncluded=function(){return this.getCart().taxIncluded},this.setCart=function(t){return this.$cart=t,this.getCart()},this.getCart=function(){return this.$cart},this.getItems=function(){return this.getCart().items},this.getTotalItems=function(){var e=0,t=this.getItems();return angular.forEach(t,function(t){e+=t.getQuantity()}),e},this.getTotalUniqueItems=function(){return this.getCart().items.length},this.getSubTotal=function(){var e=0;return angular.forEach(this.getCart().items,function(t){e+=t.getTotal()}),+h.round(e,2)},this.getSubTotalWithTax=function(){var e=0;return angular.forEach(this.getCart().items,function(t){e+=t.getTotalWithTax()}),+h.round(e,2)},this.getTotalDiscount=function(){var t=this.getPromo(),e=this.getItems();if(!t||0===e.length)return 0;var r=0;return angular.forEach(e,function(t){r+=+t.getTotalDiscount()}),+h.round(r,2)},this.totalCost=function(){return+h.round(this.getSubTotalWithTax()+this.getShipping(),2)},this.removeItem=function(t){this.$cart.items.splice(t,1),u.$broadcast("zlCart:itemRemoved",{}),u.$broadcast("zlCart:change",{})},this.removeItemById=function(r){var i=this.getCart();angular.forEach(i.items,function(t,e){t.getId()===r&&i.items.splice(e,1)}),this.setCart(i),u.$broadcast("zlCart:itemRemoved",{}),u.$broadcast("zlCart:change",{})},this.empty=function(){this.$cart.items=[],this.$cart.promo=null,u.$broadcast("zlCart:change",{})},this.isEmpty=function(){return!(0<this.$cart.items.length)},this.toObject=function(){if(0===this.getItems().length)return!1;var e=[];return angular.forEach(this.getItems(),function(t){e.push(t.toObject())}),{shipping:this.getShipping(),promo:this.getPromo(),subTotal:this.getSubTotal(),subTotalWithTax:this.getSubTotalWithTax(),totalDiscount:this.getTotalDiscount(),totalCost:this.totalCost(),items:e}},this.$restore=function(t){var e=this;e.init(),e.$cart.shipping=t.shipping,e.$cart.promo=t.promo,e.$cart.taxIncluded=t.taxIncluded,angular.forEach(t.items,function(t){e.$cart.items.push(new l(t._id,t._name,t._price,t._tax,t._quantity,t._discount,t._promo,t._data))}),this.$save()},this.$save=function(){return t.set("zlcart",JSON.stringify(this.getCart()))}}]).factory("zlCartItem",["$rootScope","zlCartUtil","$log",function(i,s,o){var t=function(t,e,r,i,o,n,a,s){this.setId(t),this.setName(e),this.setTax(i),this.setPrice(r),this.setDiscount(n),this.setQuantity(o),this.setPromo(a),this.setData(s)};return t.prototype.setId=function(t){t?this._id=t:o.error("An ID must be provided")},t.prototype.getId=function(){return this._id},t.prototype.setName=function(t){t?this._name=t:o.error("A name must be provided")},t.prototype.getName=function(){return this._name},t.prototype.setTax=function(t){this._tax=+t},t.prototype.getTax=function(t){return this._tax},t.prototype.setPrice=function(t){var e=s.round(t||0,2);0<=e?this._price=e:o.error("A price must be over 0")},t.prototype.getPrice=function(){return+s.round(this._price-this._price*this.getDiscount()/100,2)},t.prototype.setDiscount=function(t){this._discount=t||0},t.prototype.getDiscount=function(){return this._discount},t.prototype.setPromo=function(t){this._promo=t},t.prototype.getPromo=function(){return this._promo||null},t.prototype.setQuantity=function(t,e){var r=parseInt(t);r%1==0?(!0===e?this._quantity+=r:this._quantity=r,this._quantity<1&&(this._quantity=1)):(this._quantity=1,o.info("Quantity must be an integer and was defaulted to 1")),i.$broadcast("zlCart:change",{})},t.prototype.getQuantity=function(){return this._quantity},t.prototype.setData=function(t){t&&(this._data=t)},t.prototype.getData=function(){if(this._data)return this._data;o.info("This item has no data")},t.prototype.getTotalDiscount=function(){var t=this.getPromo(),e=this.getQuantity(),r=this.getPrice(),i=0;if(!t||0===e)return s.round(i,2);var o=t.value;i=o;"%"===t.symbol&&(o=+s.round(r*o/100,2));var n,a=t.parcial||1;return n=e-e%a,i="%"===t.symbol?o*n:o*(n/a),+s.round(i,2)},t.prototype.getTotal=function(){return+s.round(+this.getPrice()*+this.getQuantity()-+this.getTotalDiscount(),2)},t.prototype.getTotalWithTax=function(){return+s.round(this.getTotal()+this.getTotal()*this.getTax()/100,2)},t.prototype.toObject=function(){return{id:this.getId(),name:this.getName(),price:this.getPrice(),tax:this.getTax(),promo:this.getPromo(),quantity:this.getQuantity(),data:this.getData(),total:this.getTotal(),totalDiscount:this.getTotalDiscount(),totalWithTax:this.getTotalWithTax()}},t}]).service("zlStore",["localStorageService",function(r){this.get=function(t){if(r.get(t)){var e=angular.fromJson(r.get(t));return"object"==typeof e?e:JSON.parse(e)}return!1},this.set=function(t,e){return void 0===e?r.remove(t):r.set(t,e),r.get(t)}}]).service("zlCartDiscount",["$rootScope","zlCart","$http","$q",function(t,i,o,e){this.init=function(){this.urlDiscount=null},this.canApplyDiscount=function(){return void 0!==this.urlDiscount},this.setUrlDiscount=function(t){this.urlDiscount=t},this.getUrlDiscount=function(){return this.urlDiscount},this.setDiscount=function(t,e){var r=i.getCart();o.post(this.getUrlDiscount()+t,{cart:r}).then(function(t){t.data&&i.setPromo(t.data),e()}).catch(function(t){i.setPromo(null),e(t.data.error)})}}]).service("zlCartUtil",function(){this.round=function(t,e){void 0===e&&(e=0);var r=Math.pow(10,e);return t=+parseFloat((t*r).toFixed(11)).toFixed(1),(Math.round(t)/r).toFixed(2)}}).value("version","1.0.30"),angular.module("zlCart.directives",["zlCart.fulfilment"]).controller("zlCartController",["$scope","zlCart",function(t,e){t.zlCart=e}]).directive("zlcartAddtocart",["zlCart","zlCartDiscount",function(o,t){return{restrict:"E",controller:"zlCartController",scope:{id:"@",name:"@",quantity:"@",quantityMax:"@",price:"@",tax:"@",data:"=",checkItem:"@?"},transclude:!0,replace:!0,templateUrl:function(t,e){return void 0===e.templateUrl?"template/addtocart.html":e.templateUrl},link:function(t,e,r){t.attrs=r,t.inCart=function(){return r.checkItem?o.getItemByRegex(r.checkItem):o.getItemById(r.id)},t.inCart()?t.q=o.getItemById(r.id).getQuantity():t.q=parseInt(t.quantity),t.qtyOpt=[];for(var i=1;i<=t.quantityMax;i++)t.qtyOpt.push(i)}}}]).directive("zlcartCart",[function(){return{restrict:"E",controller:"zlCartController",scope:{},replace:!0,templateUrl:function(t,e){return void 0===e.templateUrl?"template/cart.html":e.templateUrl},link:function(t,e,r){}}}]).directive("zlcartSummary",[function(){return{restrict:"E",controller:"zlCartController",scope:{},transclude:!0,replace:!0,templateUrl:function(t,e){return void 0===e.templateUrl?"template/summary.html":e.templateUrl}}}]).directive("zlcartTax",["zlCart",function(n){return{restrict:"E",controller:"zlCartController",scope:{},transclude:!0,replace:!0,templateUrl:function(t,e){return void 0===e.templateUrl?"template/carttax.html":e.templateUrl},link:function(t,e,r){var i=!1;function o(){var a=[],s=[],c=0,u=0;angular.forEach(n.getItems(),function(t){var e=t.getTax(),r=t.getTotalWithTax()-t.getTotal(),i=t.getTotal(),o=+(r+i);if(a[e])for(var n=0;n<s.length;n++)s[n].rate===e&&(s[n].tax+=r,s[n].value+=i,s[n].subTotal+=o);else a[e]=!0,s.push({rate:e,tax:r,value:i,subTotal:o});c+=o,u+=r}),t.taxsRate=s,t.taxTotalIva=u,t.taxTotal=c,i=!1}o(),t.$on("zlCart:change",function(t,e){i||(i=!0,o())})}}}]).directive("zlcartDiscount",["zlCart","zlCartDiscount",function(i,o){return{restrict:"E",controller:"zlCartController",scope:{},transclude:!0,replace:!1,templateUrl:function(t,e){return void 0===e.templateUrl?"template/discount.html":e.templateUrl},link:function(r,t,e){r.attrs=e,r.message={},i.getPromo()&&(r.code=i.getPromo().code),r.$watch("code",function(t,e){t!==e&&(r.message={})}),r.removeCodeDiscount=function(t){i.setPromo(null)},r.setCodeDiscount=function(t){o.setDiscount(t,function(t){if(r.message.msg=!0,t)return r.message.success=!1,void(r.message.text=t);r.message.success=!0,r.message.text="CÃ³digo aplicado com sucesso.",r.code=(i.getPromo()||{}).code,setTimeout(function(){r.message.msg=!1,r.$apply()},2500)})},r.$on("zlCart:itemAdded",function(t){i.setPromo(i.getPromo())})}}}]).directive("zlcartCheckout",[function(){return{restrict:"E",scope:{service:"@",settings:"="},transclude:!0,replace:!1,templateUrl:function(t,e){return void 0===e.templateUrl?"template/checkout.html":e.templateUrl},controller:["$rootScope","$scope","$location","$route","zlCart","fulfilmentProvider",function(e,t,r,i,o,n){t.zlCart=o,t.checkout=function(){n.setService(t.service),n.setSettings(t.settings),n.checkout().then(function(t){t.data.url_redirect&&r.path(t.data.url_redirect),o.empty(),e.$broadcast("zlCart:checkout_succeeded",data)}).catch(function(t){e.$broadcast("zlCart:checkout_failed",{statusCode:t.status,error:t.data})})}}]}}]),angular.module("zlCart.fulfilment",[]).service("fulfilmentProvider",["$injector",function(t){this._obj={service:void 0,settings:void 0},this.setService=function(t){this._obj.service=t},this.setSettings=function(t){this._obj.settings=t},this.checkout=function(){return t.get("zlCart.fulfilment."+this._obj.service).checkout(this._obj.settings)}}]).service("zlCart.fulfilment.log",["$q","$log","zlCart",function(e,r,i){this.checkout=function(){var t=e.defer();return r.info(i.toObject()),t.resolve({cart:i.toObject()}),t.promise}}]).service("zlCart.fulfilment.http",["$http","zlCart",function(e,r){this.checkout=function(t){return e.post(t.url,{data:r.toObject(),options:t.options})}}]).service("zlCart.fulfilment.meowallet",["$http","zlCart",function(e,r){this.checkout=function(t){return e.post(t.url,{data:r.toObject()})}}]).service("zlCart.fulfilment.paypal",["$http","zlCart",function(t,e){}]);